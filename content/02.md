#第2章 MySQL基准测试
基准测试（benchmark）是MySQL新手和专家都需要掌握的一项基本技能。简单地说，基准测试是针对系统设计的一种压力测试。通常的目标是为了掌握系统的行为。但也有其他原因，如重现某个系统状态，或者是做新硬件的可靠性测试。

##2.1 为什么需要基准测试
为什么基准测试很重要？因为基准测试是唯一方便有效的、可以学习系统在给定的工作负载下会发生什么的方法。基准测试可以观察系统在不同压力下的行为，评估系统的容量，掌握哪些是重要的变化，或者观察系统如何处理不同的数据。基准测试可以在系统实际负载之外创造一些虚构场景进行测试。基准测试可以完成以下工作，或者更多：

- 验证基于系统的一些假设，确认这些假设是否符合实际情况。
- 重现系统中的某些异常行为，以解决这些异常。
- 测试系统当前的运行情况。
- 模拟比当前系统更高的负载，以找出系统随着压力增加而可能遇到的扩展性瓶颈。
- 规划未来的业务增长。基准测试可以评估在项目未来的负载下，需要什么样的硬件，需要多大容量的网络，以及其他相关资源。这有助于降低系统升级和重大变更的风险。
- 测试应用适应可变环境的能力。
- 测试不同的硬件、软件和操作系统配置。
- 证明新采购的设备是否配置正确。

##2.2 基准测试的策略
基准测试有两种主要的策略：一是针对整个系统的整体测试，另外是单独测试MySQL。这两种策略也被称为集成式以及单组件式基准测试。

###2.2.1 测试何种指标
- **吞吐量** 指的是单位时间内的事务处理数。常用的测试单位是每秒事务数（TPS），有些也采用每分钟事务数（TPM）。
- **响应延迟或者延迟** 用于测试任务所需的整体时间。使用图表有助于理解测试结果，直观地表现数据结果集的分布情况。
- **并发性** Web服务器的并发性是在任何时间有多少同时发生的并发请求。
- **可扩展性** 可扩展性指标对于容量规划非常有用，它可以提供其他测试无法提供的信息，来帮助发现应用的瓶颈。

##2.3 基准测试方法
以下错误可能会导致测试结果无用或者不准确：

- 使用真实数据的子集而不是全集。
- 使用错误的数据分布。例如使用均匀分布的数据测试，而系统的真实数据有很多热点区域。
- 使用不真实的分布参数。
- 在多用户场景下，只做单用户的测试。
- 在单服务器上测试分布式应用。
- 与真实用户行为不匹配。例如Web页面中的“思考时间”。真实用户在请求到一个页面后会阅读一段时间，而不是不停顿地一个接一个点击相关链接。
- 反复执行同一个查询。真实的查询是不尽相同的，这可能会导致缓存命中率降低。而反复执行同一个查询在某种程度上，会全部或者部分缓存结果。
- 没有检查错误。基准测试完成后，一定要检查一下错误日志。
- 忽略了系统预热的过程。
- 使用默认的服务器配置。
- 测试时间太短。基准测试需要持续一定的时间。

###2.3.1 设计和规划基准测试
规划基准测试的第一步是提出问题并明确目标。然后决定是采用标准的基准测试，还是设计专用的测试。